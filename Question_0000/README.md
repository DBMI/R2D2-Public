### Question
What is the performance of [the canonical SQL](sql/template_query.sql) in identifying the **patients with positive PCR test result for SARS-COV-2 or patients with COVID-19 diagnosis** against two references, **Private Reference** and **Universal Reference**, defined as:

1. **Private Reference** ground truth, private to an institution, NOT comparable between institutions and typically obtained from an institutional registry or EHR system 
2. **Universal Reference** status of PCR test results, comparable between institutions and can be obtained from (EHR / OMOP/ other source)

After uploading the query results of [the canonical SQL](sql/template_query.sql), please feel free to upload additional SQL to this GitHub repo to investigate condition components and lab results together with inclusion/exclusion criteria. 

### Note
The canonical SQL does not consider COVID-19 related hospitalizations, which will be handled separately in a question-specific SQL.

The evalution of the canoncial SQL in a single site below (355 patients are from affilate hospitals and the detailed records are not accessible to R2D2 project due to institutional policy).
![Example Results](results/example.png)


### Concept Sets
[R2D2 Phenotype Documentation, Version 3.1]


### SQL Code
Description about the [SQL](sql/template_query.sql) generated by Site10.
This canonical SQL

1. identifies the patients with positive PCR test result for SARS-COV-2 or patients with COVID-19 diagnosis after 1/1/2020 using OMOP concept identifiers
2. does not consider COVID-19 related hospitalizations, which will be handled separately in a question-specific SQL
3. replaces the local institutional methods to identify the COVID-19 patients (e.g. registry)
4. leans on the [CDC guidelines](https://www.cdc.gov/nchs/data/icd/COVID-19-guidelines-final.pdf), also reflecting [N3C cohort definition](https://github.com/National-COVID-Cohort-Collaborative/Phenotype_Data_Acquisition)
5. produces reliable results after evaluation on Site10
6. needs external validation from all R2D2 institutions


### Results
To the [results](results/) directory, please upload .csv file of 7 rows and 7 columns in the following format with a header (one .csv file per institution named as SiteXX_results.csv)
  * Column 1: Site number in the format of (SiteXX)
  * Column 2: **Private Reference** ground truth, private to an institution, NOT comparable between institutions, and typically obtained from an institutional registry or EHR system, yes if a patient is found in the institutional registry and no otherwise.
  * Column 3: **Universal Reference** status of PCR test results comparable between institutions, can be obtained from EHR directly, from OMOP, or any other sources, yes if a  patient has a record of positive PCR test result for SARS-COV-2 and no otherwise ('no' includes negative test result, not tested or unknown)
  * Column 4: **Proposed Method**, yes if a patient is present in [the canonical SQL](sql/template_query.sql), an OMOP-based R2D2 cohort definition for patients with positive PCR test result for SARS-COV-2 or patients with SARS-COV-2 positive diagnosis codes after 1/1/2020, and no otherwise.
  * Column 5: Number of patients
  * Column 6: Query version
  * Column 7: Query execution date 

Note that the row with (column 2 == no, column 3 == no, column 4 == no) is not included.
See the [template result](results/template_results.csv) file.


### Backup
```sql
Initial Cohort Validation Query
Objective: Verify that COVID-19 patients and tests have been identified in source data (100% of patients that are in OMOP)
* Query 1a - count and proportion of patients with each code (or regex match) among confirmed COVID-19 patients
* Query 1b - count and proportion of pateints with each code (or regex match) among non-COVID-19 patients

**Methods**: Search OMOP source fields in relevant tables (especially unmapped codes)
*Tables* - Condition, Observation, Measurement, Procedures (for lab test orders)

CSV file in sql folder has initial list that will be extended

**Sites may have to modify to search raw Clairty or Cerner DBs**
```
